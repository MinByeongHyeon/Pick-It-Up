<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 생성</title>
    <!-- <link rel="stylesheet" href="/assets/css/createProject.css" /> -->
    <link rel="stylesheet" href="/assets/css/createProject.css">
    <!-- <link rel="stylesheet" href="/assets/css/createProject.css" /> -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>
<body>
    <div class="main">
        <div class="cpTitleFrame">
            <div class="cpTitleForm">
                <img src="/src/main/resources/static/images/chun2.png" class="logoImg">
                <div class="cpTitle">프로젝트 작성하기</div>
                <div class="cpTitlepercent">0% 완료</div>
                <div class="cpTitleBtnFrame">
                    <button type="button" class="cpExitBtnForm">
                        <span class="cpExitBtn">나가기</span>
                    </button>
                </div>
            </div>
            <div class="cpTitleBoundary">
                <div class="cpProcessBar" style="transform: translateX(-100%);"></div>
            </div>
        </div>
        <div class="cpBodyFrame">
            <div class="cpSidebarBoundary"></div>
            <div class="cpSidebarFrame">
                <div class="cpSidebarForm">
                    <span class="sidebarStep1Frame">
                        <a class="sidebarStepForm">
                            <span class="sidebarStepBox">
                                <div class="sidebarCheckBox">
                                    <span class="material-symbols-outlined">looks_one</span>                                                                                
                                </div>
                                <div class="sidebarStepTitle1">기본 정보</div>
                            </span>                    
                        </a>
                    </span>
                    <span class="sidebarStepFrame">
                        <a class="sidebarStepForm">
                            <span class="sidebarStepBox">
                                <div class="sidebarCheckBox">
                                    <span class="material-symbols-outlined">looks_two</span>                                                                                
                                </div>
                                <div class="sidebarStepTitle">제목 및 커버</div>
                            </span>                    
                        </a>
                    </span>
                    <span class="sidebarStepFrame">
                        <a class="sidebarStepForm">
                            <span class="sidebarStepBox">
                                <div class="sidebarCheckBox">
                                    <span class="material-symbols-outlined">looks_3</span>                                                                                
                                </div>
                                <div class="sidebarStepTitle">소개</div>
                            </span>                    
                        </a>
                    </span>
                    <span class="sidebarStepFrame">
                        <a class="sidebarStepForm">
                            <span class="sidebarStepBox">
                                <div class="sidebarCheckBox">
                                    <span class="material-symbols-outlined">looks_4</span>                                                                                
                                </div>
                                <div class="sidebarStepTitle">단체 소개</div>
                            </span>                    
                        </a>
                    </span>
                    <span class="sidebarStepFrame">
                        <a class="sidebarStepForm">
                            <span class="sidebarStepBox">
                                <div class="sidebarCheckBox">
                                    <span class="material-symbols-outlined">looks_5</span>                                                                                
                                </div>
                                <div class="sidebarStepTitle">오픈 전 확인사항</div>
                            </span>                    
                        </a>
                    </span>
                </div>
            </div>
            <div class="cpContentFrame">
                <div class="cpContentForm">
                    <div class="cpContentContainer">
                        <div class="basicInfoContainer">
                            <div class="basicInfoBox">
                                <h3 class="basicInfoText">프로젝트 기본정보를 입력해주세요</h3>
                                <div class="basicInfoSubText">사용자들에게 프로젝트의 기본정보를 알려주세요!<br>지형과 거리에 따라 포인트가 추가 지급 됩니다.<br>( 산 : +100p, 바닷가 : +50p, 3km까지 100p 3km 초과 시 1km 마다 50p 추가 )                                                                         
                                </div>
                                <form action="#">
                                    <div class="formTerrain">
                                        <label class="formTerrainLabel">지형</label>
                                        <select class="formTerrainSelect">
                                            <option value hidden disalbed>지형을 입력해주세요.</option>
                                            <option class="mountain" value="mountain">산 ( +100p )</option>
                                            <option class="beach" value="beach">바닷가 ( + 50p )</option>
                                            <option class="ground" value="ground">평지</option>
                                        </select>
                                    </div>
                                    <div class="formCourse">
                                        <label class="formCourseLabel">코스 / 장소</label>
                                        <div class="formCoureSelectBox">
                                            <select class="formCourseSelect" id="selectCourse" onchange="ChangeValue()">
                                                <option value="place">장소</option>
                                                <option value="course">코스 ( 3km까지 100p 3km 초과 시 1km 마다 50p 추가 )</option>
                                            </select>                        
                                            <div class="addressBox">
                                                <label class="formCourseLabel">출발지</label>
                                                <div class="addressForm">
                                                <input type="text" id="start_address" placeholder="주소" readonly>
                                                <input type="button" class="find_address" id="find_start_address" value="주소 찾기">
                                                </div>
                                                <div style="width: 100%;">
                                                    <div style="width: 71%;">
                                                        <input type="text" id="start_addressDetail" placeholder="상세주소">
                                                    </div>
                                                </div>                                                
                                            </div>
                                                     <input type="hidden" id="x1">
                                                     <input type="hidden" id="y1">
                                                     <input type="hidden" id="x2">
                                                     <input type="hidden" id="y2">
                                            <div class="addressBoxEnd">
                                                <label class="formCourseLabel">도착지</label>
                                                <div class="addressForm">
                                                <input type="text" id="end_address" placeholder="주소" readonly>
                                                <input type="button" class="end_address" id="find_end_address" value="주소 찾기">
                                                </div>
                                                <div style="width: 100%;">
                                                    <div style="width: 71%;">
                                                        <input type="text" id="end_addressDetail" placeholder="상세주소">
                                                    </div>
                                                </div>                                                 
                                            </div>
                                            <div style="width: 100%; margin-top: 10px; margin-bottom: 60px; font-size: 15px;     font-family: 'Noto Sans KR', sans-serif;">
                                                <div style="width: 71%; display: flex; justify-content: space-between;">
                                                    <div>예상 지급 포인트</div>
                                                    <div style="display: flex;"><p style="margin: 0;" id="distance_point"></p>P</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                   
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 옆에 배너입니다 cpContentForm 끝나는 부분에 넣어주시면 됩니다 -->
                <div class="cpThumbNailFrame">
                    <div class="cpThumbNailForm">
                        <div class="cpThumbNailContainer">
                            <div class="cpThumbNailBox">
                                <div class="cpThumbNailInsertForm">
                                    <img src="/src/main/resources/static/images/add-photo-portrait.png" class="defaultImg">
                                </div>
                                <div class="cpThumbNailInfoForm">
                                    <div class="cpThumbNailInfoBox">
                                        <div class="cpThumbNailInfoName">by. 모집단체</div>
                                    </div>
                                    <div class="cpThumbNailInfoBox">
                                        <div class="cpThumbNailInfoTerrain">지형을 선택해주세요</div>
                                    </div>
                                    <div class="cpThumbNailInfoBox">
                                        <div class="cpThumbNailInfoCourse">진행 방식을 선택해주세요</div>
                                    </div>
                                    <h3 class="cpThumbNailInfoText"></h3>
                                </div>
                                <div class="cpThumbNailBlur"></div>                             
                            </div>
                            <div class="cpThumbNailProgressBox">
                                <span class="cpThumbNailProgressComplete"></span>
                                <span class="cpThumbNailProgress"></span>
                                <span class="cpThumbNailProgress"></span>
                                <span class="cpThumbNailProgressLast"></span>
                            </div>
                            <div class="cpThumbNailPrevBox"></div>
                            <button type="button" class="thunmbPrevBtn">
                                <span class="thumbPrevForm">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M15.5 5.5l-6 6.5 6 6.5L14 20l-7.5-8L14 4l1.5 1.5z" fill="#FFF"></path></svg>
                                </span>
                            </button>
                            <div class="cpThumbNailNextBox"></div>
                            <button type="button" class="thumbNextBtn">
                                <span class="thumbNextForm">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.5 18.5l6-6.5-6-6.5L10 4l7.5 8-7.5 8-1.5-1.5z" fill="#FFF"></path></svg>
                                </span>
                            </button>                          
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="nextBtnFrame">
            <button type="button" class="savePage">
                <span class="savePageBtn">저장하기</span>
            </button>
            <button type="submit" class="nextPage">
                <span class="nextPageBtn">다음</span>
            </button>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=nshb4pb9af&submodules=geocoder"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    
    let endAddress = document.querySelector(".addressBoxEnd");
    function ChangeValue(){
        let selectCourse = document.getElementById("selectCourse");
        selectCourse = selectCourse.options[selectCourse.selectedIndex].value;
        console.log(selectCourse);
        if(selectCourse == "course") {
            endAddress.classList.add('show');
        } else {
            endAddress.classList.remove('show');
        }
    }

    window.onload = function(){
        document.getElementById("find_start_address").addEventListener("click", function(){ //주소입력칸을 클릭하면
            //카카오 지도 발생
            new daum.Postcode({
                oncomplete: function(data) { //선택시 입력값 세팅
                    document.getElementById("start_address").value = data.address; // 주소 넣기
                    xy(data.address,1);
                }
            }).open();
        });
        document.getElementById("find_end_address").addEventListener("click", function(){ //주소입력칸을 클릭하면
            //카카오 지도 발생
            new daum.Postcode({
                oncomplete: function(data) { //선택시 입력값 세팅
                    document.getElementById("end_address").value = data.address; // 주소 넣기
                    xy(data.address,2);
                }
            }).open();
        });
            
    }

    let 출발 = [];
    let 도착 = [];
    let default_point=100;
    let real_point=0;
    $('#distance_point').text(default_point);

    $('.formTerrainSelect').change(function(){
        if($(this).val()=="mountain"){
            if(real_point!=0){
                default_point = 100;
            }else{
                default_point = 200;
            }
            $('#distance_point').text(default_point+real_point);
        }
        else if($(this).val()=="beach"){
            if(real_point!=0){
                default_point = 50;
            }else{
                default_point = 150;
            }
            $('#distance_point').text(default_point+real_point);
        }
        else if($(this).val()=="ground"){
            if(real_point!=0){
                default_point = 0;
            }else{
                default_point = 100;
            }
            $('#distance_point').text(default_point+real_point);
        }

    })

    // x,y 좌표 받아오기    
    

// 주소값과 번호를 받아와서  주소 값으로 좌표 생성, 번호로 어느것을 눌렀는지 확인.
    function xy(ad,i){
        if(i==1){ //출발지 눌렀을떄
            naver.maps.Service.geocode({
                query: ad
            }, function(status, response) {
                if (status !== naver.maps.Service.Status.OK) {
                    return alert('Something wrong!');
                }
                
            
                var result = response.v2, // 검색 결과의 컨테이너
                    items = result.addresses; // 검색 결과의 배열
                    
                    try {
                        $('#x'+i).val(items[0].x);  //주소의 x좌표값을 input에 삽입
                        $('#y'+i).val(items[0].y);  //주소의 x좌표값을 input에 삽입
                    } catch (error) {
                        alert('요청하신 주소의 좌표를 찾을 수 없습니다.');
                        document.getElementById("start_address").value = "";
                        return;
                    }
                     
                    if(출발.length==0){ //처음 장소 넣을때
                        출발.push(items[0].x);
                        출발.push(items[0].y);
                     
                        console.log(출발[0]);
                        console.log(출발[1]);
                       
                     
                    }else if(출발.length==2){ //출발지만 입력후 출발지 수정
                        출발[0]=items[0].x;      //수정함
                        출발[1]=items[0].y;      //수정함
                        console.log(출발[0]);
                        console.log(출발[1]);
                    }
                    if((출발.length + 도착.length) == 4){
                        dist();
                    }
            });
        }else{ //도착지 눌렀을때.
            naver.maps.Service.geocode({
                query: ad
            }, function(status, response) {
                if (status !== naver.maps.Service.Status.OK) {
                    return alert('Something wrong!');
                }
            
                var result = response.v2, // 검색 결과의 컨테이너
                    items = result.addresses; // 검색 결과의 배열

                    try {
                        $('#x'+i).val(items[0].x);  //주소의 x좌표값을 input에 삽입
                        $('#y'+i).val(items[0].y);  //주소의 x좌표값을 input에 삽입
                    } catch (error) {
                        alert('요청하신 주소의 좌표를 찾을 수 없습니다.');
                        document.getElementById("end_address").value = "";
                        return;
                    }

                if(도착.length==0){ //처음 도착지 눌렀을때
                    도착.push(items[0].x);
                    도착.push(items[0].y);
                    console.log(도착[0]);
                    console.log(도착[1]);
                }else if(도착.length==2){
                    도착[0] = (items[0].x); //수정함
                    도착[1] = (items[0].y);
                    console.log(도착[0]);
                    console.log(도착[1]);
                }
                if((출발.length + 도착.length) == 4){
                    dist();
                }
            });
        }
    }
    
   function dist(){
        let distance_point =  Math.sqrt(Math.pow(출발[0]-도착[0],2) + Math.pow(출발[1]-도착[1],2));
        let distance = distance_point*111;
        let real_distance = Math.round(distance);  // km 단위
        console.log(real_distance);
        real_point = default_point+(real_distance-3)*50; //3 키로가 넘으면 1km 당 50p
        if(real_point<default_point){
            real_point = default_point;
        }
        $('p#distance_point').empty().text(real_point);
   }

</script>
</html>